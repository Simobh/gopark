<app-navbar></app-navbar>
<div style="height:80px;"></div>

<div class="container py-5">

  <div class="d-flex justify-content-between align-items-center mb-5">
    <div class="d-flex align-items-center gap-3">
      <div class="rounded-circle d-flex align-items-center justify-content-center"
           style="width:52px;height:52px;background:linear-gradient(135deg,#6366f1,#4f46e5);">
        <mat-icon class="text-white">notifications</mat-icon>
      </div>

      <div>
        <h3 class="mb-0 fw-bold">Messages reçus</h3>
        <small class="text-muted">Gestion des messages envoyés par les utilisateurs</small>
      </div>
    </div>

    <span class="badge text-white px-4 py-2"
          style="background:linear-gradient(135deg,#2563eb,#3b82f6);border-radius:999px;">
      {{ unreadMessages.length > 0 ? unreadMessages.length + ' nouveaux' : 'Tout est lu' }}
    </span>
  </div>

  <div *ngIf="unreadMessages.length === 0" class="text-center py-5">
    <mat-icon style="font-size:64px;color:#c7d2fe;">mark_email_read</mat-icon>
    <h5 class="mt-3 fw-bold">Aucun nouveau message</h5>
    <p class="text-muted">Tous les messages ont été traités</p>
  </div>

  <div class="row g-4 mb-5">
    <div class="col-12 col-md-6 col-xl-4"
         *ngFor="let msg of unreadMessages"
         @slideFade>

      <div class="card h-100 border-0 position-relative"
           style="border-radius:20px;box-shadow:0 25px 60px rgba(0,0,0,.1);overflow:hidden;">

        <div style="position:absolute;left:0;top:0;height:100%;width:5px;background:#ef4444;"></div>

        <div class="p-3 d-flex justify-content-between align-items-center"
             style="background:#f1f5ff;">
          <div class="d-flex align-items-center gap-2">
            <mat-icon color="primary">person</mat-icon>
            <strong>{{ msg.name }}</strong>
          </div>

          <span class="badge text-white px-3"
                style="background:#ef4444;border-radius:999px;">
            Nouveau
          </span>
        </div>

        <div class="card-body p-4">
          <div class="d-flex align-items-center gap-2 text-muted small mb-3">
            <mat-icon
              class="fs-6"
              style="line-height:1; display:flex; align-items:center;"
            >
              mail
            </mat-icon>

            <span>{{ msg.email }}</span>
          </div>


          <div class="p-3 mb-4"
               style="background:#f8fafc;border-radius:14px;">
            {{ msg.message }}
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2 text-muted small">
              <mat-icon class="fs-6">schedule</mat-icon>
              {{ msg.createdAt?.toDate() | date:'short' }}
            </div>

            <button
              class="btn btn-sm text-white px-4 ms-3"
              style="background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:999px;"
              (click)="markAsRead(msg.id)"
            >
              Marquer comme lu
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="readMessages.length > 0">
    <h5 class="fw-bold text-muted mb-4">Messages lus</h5>

    <div class="row g-4">
      <div class="col-12 col-md-6 col-xl-4"
           *ngFor="let msg of readMessages"
           @slideFade>

        <div class="card border-0"
             style="border-radius:20px;background:#f8fafc;box-shadow:0 12px 30px rgba(0,0,0,.06);">

          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <strong>{{ msg.name }}</strong>
              <span class="badge text-white px-3"
                    style="background:linear-gradient(135deg,#22c55e,#16a34a);border-radius:999px;animation:pulse 1.1s;">
                Lu
              </span>
            </div>

            <div class="small text-muted">{{ msg.email }}</div>

            <div class="mt-3 small">{{ msg.message }}</div>

            <div class="text-muted small mt-3">
              {{ msg.createdAt?.toDate() | date:'short' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<style>
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.12); }
  100% { transform: scale(1); }
}
</style>
